<template>
  <lightning-card>
    <div class="slds-var-m-around_medium">
      <!-- Spinner for loading -->
      <template if:true={isLoading}>
        <div class="slds-align_absolute-center">
          <lightning-spinner alternative-text="Loading" size="large"></lightning-spinner>
        </div>
      </template>
      <form class="slds-form slds-form_stacked">
        <div class="slds-grid slds-wrap">
          <!-- Column 1 -->
          <div class="slds-size_1-of-2">
            <lightning-input
              label="License Number"
              name="licenseNumber"
              value={licenseNumber}
              onchange={handleInputChange}
              onfocus={hideProfessionAndStateLists}
              disabled={shouldDisableInputFields}
              data-id="licenseNumber"
              placeholder="ex. 1234567890"
              maxlength="10"
              required
            >
            </lightning-input>

            <c-searchable-input
              data-id="state"
              label="State"
              options={stateOptions}
              cmp-name={cmpName}
              onselect={handleStateChange}
              onclick={hideProfessionsList}
              disabled={shouldDisableInputFields}
              placeholder="Select a State"
              required
            ></c-searchable-input>

            <c-searchable-input
              data-id="profession"
              label="Profession"
              options={professionOptions}
              cmp-name={cmpName}
              onselect={handleProfessionChange}
              onclick={hideStatesList}
              disabled={shouldDisableProfessionInput}
              is-loading={isLoadingProfessions}
              placeholder="Select a Profession"
              required
            ></c-searchable-input>

            <lightning-input
              label="Cert State"
              name="certState"
              value={certState}
              onchange={handleInputChange}
              onfocus={hideProfessionAndStateLists}
              disabled={shouldDisableInputFields}
              data-id="certState"
              placeholder="ex. CA"
              maxlength="2"
            >
            </lightning-input>
          </div>

          <!-- Column 2 -->
          <div class="slds-size_1-of-2">
            <lightning-input
              label="First Name"
              name="firstName"
              value={firstName}
              onchange={handleInputChange}
              onfocus={hideProfessionAndStateLists}
              disabled={shouldDisableInputFields}
              data-id="firstName"
              placeholder="ex. Joe"
              maxlength="50"
            >
            </lightning-input>

            <lightning-input
              label="Middle Name"
              name="middleName"
              value={middleName}
              onchange={handleInputChange}
              onfocus={hideProfessionAndStateLists}
              disabled={shouldDisableInputFields}
              data-id="middleName"
              placeholder="ex. J"
              maxlength="50"
            >
            </lightning-input>

            <lightning-input
              label="Last Name"
              name="lastName"
              value={lastName}
              onchange={handleInputChange}
              onfocus={hideProfessionAndStateLists}
              disabled={shouldDisableInputFields}
              data-id="lastName"
              placeholder="ex. Doe"
              maxlength="50"
            >
            </lightning-input>

            <div class="slds-card__body custom-card-body">
              <label class="slds-form-element__label slds-no-flex" for="dateInputId">Date Of Birth</label>
              <input
                class="slds-form-element__control slds-grow slds-input"
                type="date"
                id="dateInputId"
                name="dateOfBirth"
                value={dateOfBirth}
                onchange={handleInputChange}
                onfocus={hideProfessionAndStateLists}
                disabled={shouldDisableInputFields}
                data-id="dateOfBirth"
                placeholder="YYYY-MM-DD"
                max={currentDate}
              />
            </div>
          </div>
        </div>
      </form>
    </div>
    <div class="slds-grid">
      <div class="slds-size_1-of-2">
        <lightning-button
          class="slds-button slds-size--full"
          variant="brand"
          type="submit"
          label="Submit"
          disabled={shouldDisableInputFields}
          onclick={handleSubmit}
        >
        </lightning-button>
      </div>
      <div class="slds-size_1-of-2">
        <lightning-button
          class="slds-button slds-size--full"
          variant="brand"
          type="button"
          label="Clear"
          onclick={handleClearButtonClick}
        >
        </lightning-button>
      </div>
    </div>

    <!-- Show Init result -->
    <template if:true={showResultContent}>
      <lightning-card>
        <div class="card-subtitle">Search Result</div>
        <div class="result-container slds-var-m-around_medium">
          <p><strong>Request ID:</strong> {result.batchId}</p>
          <p><strong>Added At:</strong> {result.addedAt}</p>
        </div>
      </lightning-card>
      <lightning-card>
        <div class="card-subtitle">Data Summary Requested</div>
        <div class="summary-container slds-var-m-around_medium">
          <p>
            <strong>License Number:</strong>
            {result.formDataInput.licenseNumber}
          </p>
          <p><strong>State Code:</strong> {result.formDataInput.stateCode}</p>
          <p>
            <strong>Profession Code:</strong>
            {result.formDataInput.professionCode}
          </p>
          <p><strong>First Name:</strong> {result.formDataInput.firstName}</p>
          <p><strong>Middle Name:</strong> {result.formDataInput.middleName}</p>
          <p><strong>Last Name:</strong> {result.formDataInput.lastName}</p>
          <p><strong>Cert State:</strong> {result.formDataInput.certState}</p>
          <p><strong>Date Of Birth:</strong> {result.formDataInput.dateOfBirth}</p>
        </div>
      </lightning-card>
    </template>

    <!-- Show Request/Field Error -->
    <template if:true={shouldShowError}>
      <div class="slds-text-color_error slds-text-align_center slds-var-m-around_medium" role="alert">
        <div>
          <p>
            <lightning-icon
              icon-name="utility:error"
              alternative-text="Error!"
              variant="error"
              title="Error!"
              size="x-small"
            >
            </lightning-icon>
            <template if:true={errorObject.title}> {errorObject.title} </template>
            <template if:true={fieldErrorMessage}> {fieldErrorMessage} </template>
          </p>
        </div>
        <template if:true={errorObject.message}>
          <p>Message: {errorObject.message}</p>
        </template>
        <template if:true={errorObject.code}>
          <p>Code: {errorObject.code}</p>
        </template>
        <template if:true={errorObject.status}>
          <p>Status: {errorObject.status}</p>
        </template>
      </div>
    </template>
  </lightning-card>
</template>